
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Solving Performance Issues &#8212; Practical Data Science</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parallel Computing" href="parallelism.html" />
    <link rel="prev" title="Speed in Python" href="performance_understanding.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Solving-Performance-Issues">
<h1>Solving Performance Issues<a class="headerlink" href="#Solving-Performance-Issues" title="Permalink to this headline">¶</a></h1>
<p>So: you’ve done all the things suggested in the last page on <a class="reference internal" href="performance_understanding.html"><span class="doc">Performance basics</span></a> that you can do within the constraints of your project, and you still have a performance problem. Now what?</p>
<div class="section" id="Profiling-Code">
<h2>Profiling Code<a class="headerlink" href="#Profiling-Code" title="Permalink to this headline">¶</a></h2>
<p><strong>If you take nothing else away from this page, please read and remember this section!</strong></p>
<p>There’s no reason to tune a line of code that is only responsible for 1/100 of your running time, so before you invest in speeding up your code, figure out <em>exactly</em> what in your code is causing it to be slow – a process known as “profiling”.</p>
<p>Thankfully, because this is so important, there are lots of tools (called profilers) for measuring exactly how long your computer is spending doing each step in a block of code. Here are a couple, with some demonstrations below:</p>
<ul class="simple">
<li><p>Profiling in R: the two packages I’ve seen used most are <a class="reference external" href="http://www.stat.berkeley.edu/~nolan/stat133/Fall05/lectures/profilingEx.html">Rprof</a> and <a class="reference external" href="http://adv-r.had.co.nz/Profiling.html#measure-perf">lineprof</a>.</p></li>
<li><p>Profiling in Python: if you use Jupyter Notebooks or Jupyter Labs, you can use the <a class="reference external" href="http://pynash.org/2013/03/06/timing-and-profiling.html">prun tool</a>. If for some reason you’re not using Jupyter, here’s a <a class="reference external" href="https://zapier.com/engineering/profiling-python-boss/">guide to a few other tools</a>.</p></li>
</ul>
<div class="section" id="Profiling-Example">
<h3>Profiling Example<a class="headerlink" href="#Profiling-Example" title="Permalink to this headline">¶</a></h3>
<p>To illustrate, let’s write a function (called <code class="docutils literal notranslate"><span class="pre">my_analysis</span></code>) which we can pretend is a big analysis that’s causing me problems. Within this analysis we’ll place several functions, most of which are fast, but one of which is slow. To make it <em>really</em> easy to see what is fast and what is slow, these functions will just call the <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> function, which literally just tells the computer to pause for a given number of seconds (i.e. <code class="docutils literal notranslate"><span class="pre">time.sleep(10)</span></code> makes execution pause for 10 seconds).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">a_slow_function</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">a_medium_function</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">a_fast_function</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">my_analysis</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a_slow_function</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a_medium_function</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a_fast_function</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;the result of my analysis is: </span><span class="si">{x}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">my_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
the result of my analysis is: 3
</pre></div></div>
</div>
<p>Now we can profile this code with the IPython magic <code class="docutils literal notranslate"><span class="pre">%prun</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">prun</span> my_analysis()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
the result of my analysis is: 3

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>      44 function calls in 6.009 seconds

Ordered by: internal time

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     2    6.009    3.004    6.009    3.004 {built-in method time.sleep}
     3    0.000    0.000    0.000    0.000 socket.py:337(send)
     1    0.000    0.000    6.009    6.009 {built-in method builtins.exec}
     1    0.000    0.000    6.009    6.009 &lt;ipython-input-2-2718bcdb1d57&gt;:14(my_analysis)
     3    0.000    0.000    0.000    0.000 iostream.py:197(schedule)
     2    0.000    0.000    0.000    0.000 iostream.py:384(write)
     1    0.000    0.000    0.000    0.000 {built-in method builtins.print}
     3    0.000    0.000    0.000    0.000 threading.py:1080(is_alive)
     1    0.000    0.000    1.004    1.004 &lt;ipython-input-2-2718bcdb1d57&gt;:7(a_medium_function)
     3    0.000    0.000    0.000    0.000 threading.py:1038(_wait_for_tstate_lock)
     2    0.000    0.000    0.000    0.000 iostream.py:309(_is_master_process)
     1    0.000    0.000    5.005    5.005 &lt;ipython-input-2-2718bcdb1d57&gt;:3(a_slow_function)
     3    0.000    0.000    0.000    0.000 {method &#39;acquire&#39; of &#39;_thread.lock&#39; objects}
     2    0.000    0.000    0.000    0.000 iostream.py:322(_schedule_flush)
     3    0.000    0.000    0.000    0.000 iostream.py:93(_event_pipe)
     2    0.000    0.000    0.000    0.000 {built-in method posix.getpid}
     3    0.000    0.000    0.000    0.000 {method &#39;append&#39; of &#39;collections.deque&#39; objects}
     1    0.000    0.000    6.009    6.009 &lt;string&gt;:1(&lt;module&gt;)
     3    0.000    0.000    0.000    0.000 threading.py:507(is_set)
     2    0.000    0.000    0.000    0.000 {built-in method builtins.isinstance}
     1    0.000    0.000    0.000    0.000 {method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects}
     1    0.000    0.000    0.000    0.000 &lt;ipython-input-2-2718bcdb1d57&gt;:11(a_fast_function)
</pre></div>
</div>
</div>
<p>The output shows a number of things, but the most important are <code class="docutils literal notranslate"><span class="pre">tottime</span></code> and <code class="docutils literal notranslate"><span class="pre">cumtime</span></code>.</p>
<p>From <code class="docutils literal notranslate"><span class="pre">tottime</span></code> we can see that 6 seconds was dedicated to running <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code>.</p>
<p>From <code class="docutils literal notranslate"><span class="pre">cumtime</span></code>, you can also see <em>in which functions</em> <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> took the most time. As you can see, <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> is not equal to the total time the function took to run – rather, it’s all the time spent within each function. <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> has a <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> of 6.009 because a total of 6 seconds was spend while that function ran, but it is <em>also</em> the case that <code class="docutils literal notranslate"><span class="pre">a_slow_function</span></code> (listed as <code class="docutils literal notranslate"><span class="pre">&lt;ipython-input-2-2718bcdb1d57&gt;:3(a_slow_function)</span></code>) has a <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> of 5 seconds (because
that function was in the process of executing when <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> paused for 5 seconds).</p>
<p>From this, we can deduce that <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> was slowing down our code, and that the occurance of <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> that slowed down our code the most was in <code class="docutils literal notranslate"><span class="pre">a_slow_function</span></code>.</p>
</div>
</div>
<div class="section" id="Speeding-Code-with-Cython">
<h2>Speeding Code with Cython<a class="headerlink" href="#Speeding-Code-with-Cython" title="Permalink to this headline">¶</a></h2>
<p>There are two libraries designed to allow you to massively speed up Python code. The first is called <code class="docutils literal notranslate"><span class="pre">Cython</span></code>, and it is a way of writing code that is basically Python with type declarations. For example, if you wanted to add up all the numbers to a million in Python, you could write something like the following (obviously not the most concise way to do it, but you get the idea):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">avg_numbers_up_to</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">adding_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">adding_total</span> <span class="o">=</span> <span class="n">adding_total</span> <span class="o">+</span> <span class="n">i</span>

    <span class="n">avg</span> <span class="o">=</span> <span class="n">adding_total</span> <span class="o">/</span> <span class="n">N</span>

    <span class="k">return</span> <span class="n">avg</span>
</pre></div>
</div>
</div>
<p>But in Cython, you would write:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">avg_numbers_up_to</span><span class="p">(</span><span class="nb">int</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">adding_total</span>

    <span class="n">adding_total</span> <span class="o">=</span> <span class="mf">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">adding_total</span> <span class="o">=</span> <span class="n">adding_total</span> <span class="o">+</span> <span class="n">i</span>

    <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">avg</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="n">adding_total</span> <span class="o">/</span> <span class="n">N</span>

    <span class="k">return</span> <span class="n">avg</span>
</pre></div>
</div>
<p>Then to integrate this into your Python code, you would save this function definition into a new file (with the suffix <code class="docutils literal notranslate"><span class="pre">.pyx</span></code> (say, <code class="docutils literal notranslate"><span class="pre">avg_numbers.pyx</span></code>), and put this code at the top of your Python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">from</span> <span class="nn">Cython.Build</span> <span class="kn">import</span> <span class="n">cythonize</span>

<span class="n">setup</span><span class="p">(</span><span class="n">ext_modules</span><span class="o">=</span><span class="n">cythonize</span><span class="p">(</span><span class="s1">&#39;avg_numbers.pyx&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Then you can call your Cythonized function (<code class="docutils literal notranslate"><span class="pre">avg_number_up_to</span></code>) in your normal Python script, but you’ll now find it runs ~10x - 100x faster! (Note that this speedup is only likely when compared to <em>pure python</em> code. If you’re comparing Cython to a library function that was already written in C, youre Cythonized Python is unlikely be any faster (and may be slower) than that library function.</p>
<p>Also, note that <strong>in Cythonized code, loops are just as fast as vectorized code!</strong></p>
<div class="section" id="Cython-limitations">
<h3>Cython limitations<a class="headerlink" href="#Cython-limitations" title="Permalink to this headline">¶</a></h3>
<p>There are a few limitations to be aware of, however:</p>
<ul class="simple">
<li><p>Cython only really works with (a) native Python and (b) NumPy (<a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/numpy_tutorial.html#numpy-tutorial">numpy instructions here</a>). <em>Some</em> other Python libraries are / can be supported, but it’s not nearly as straightfoward as the example above.</p>
<ul>
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html">Here’s a guide to use with pandas.</a></p></li>
</ul>
</li>
<li><p>The function you write will <em>not</em> be dynamically typed, so if you said the function would accept integers, you can only give it integers.</p></li>
<li><p>Distributing code you write with Cython can be tricky.</p></li>
</ul>
</div>
</div>
<div class="section" id="Speeding-Code-with-Numba">
<h2>Speeding Code with Numba<a class="headerlink" href="#Speeding-Code-with-Numba" title="Permalink to this headline">¶</a></h2>
<p>Another tool you can use is <code class="docutils literal notranslate"><span class="pre">numba</span></code>. Numba is a program that, when it works, is <em>super easy</em> and kinda magic, but can also be rather finicky.</p>
<p>The idea of <code class="docutils literal notranslate"><span class="pre">numba</span></code> is that it treats each function like it’s own little program, and tries to compile it to make it faster.</p>
<p>It can operate in two modes. In the first (“python mode”), it achieves it’s speed-up by saving the machine code that was used the first time a function is run. The speed benefits of this aren’t huge – Python still has to do all the work of doing type checking and de-referencing, but it only has to actually convert what it’s doing to machine code once, so if you plan on using a function over and over, it can be beneficial.</p>
<p>The second mode (“nopython mode”) is blazing fast. In nopython mode, <code class="docutils literal notranslate"><span class="pre">numba</span></code> analyzes your function, and then makes inferences about the types of variables that it will encounter. For example, if you gave the following code to Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_big_loop</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">accumulator</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">accumulator</span> <span class="o">=</span> <span class="n">accumulator</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">accumulator</span>
</pre></div>
</div>
<p>And then you ran that code with <code class="docutils literal notranslate"><span class="pre">N=1000000</span></code>, then <code class="docutils literal notranslate"><span class="pre">numba</span></code> would look at the function and think to itself “ok, so <code class="docutils literal notranslate"><span class="pre">N</span></code> is an integer. And <code class="docutils literal notranslate"><span class="pre">accumulator</span></code> starts as an integer. And if I add integers, they will always stay integers. So <code class="docutils literal notranslate"><span class="pre">accumulator</span> <span class="pre">+</span> <span class="pre">i</span></code> will always be integer addition. So I don’t have to think about types at every stop of this loop!</p>
<p>The only catch is that <code class="docutils literal notranslate"><span class="pre">numba</span></code> can’t always do <code class="docutils literal notranslate"><span class="pre">nopython</span></code> mode. For example, <code class="docutils literal notranslate"><span class="pre">numba</span></code> isn’t compatible with <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, so if you put <code class="docutils literal notranslate"><span class="pre">pandas</span></code> code in a function you pass to <code class="docutils literal notranslate"><span class="pre">numba</span></code>, it can’t work in <code class="docutils literal notranslate"><span class="pre">nopython</span></code> mode.</p>
<p>But when it does work, it’s magic, because instead of making a new file that has to be compiled seperately and which won’t “just work” on other computers, to make <code class="docutils literal notranslate"><span class="pre">numba</span></code> work you just add a “decorator” to the function you want to speed up. For example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Without numba</span>
<span class="k">def</span> <span class="nf">my_big_loop</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">accumulator</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">accumulator</span> <span class="o">=</span> <span class="n">accumulator</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">accumulator</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">timeit</span> my_big_loop(1000000)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
59.4 ms ± 2.07 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># With numba</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="k">import</span> <span class="n">jit</span>

<span class="c1"># We just add this &quot;decorator&quot; (A line that starts with @ just above a function)</span>
<span class="c1"># The &quot;nopython=True&quot; option says to jit &quot;tell me if you can&#39;t work in nopython more,</span>
<span class="c1"># dont&#39; just silently revert to Python mode.&quot;</span>
<span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_big_loop</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">accumulator</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">accumulator</span> <span class="o">=</span> <span class="n">accumulator</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">accumulator</span>

<span class="o">%</span><span class="k">timeit</span> my_big_loop(1000000)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
174 ns ± 5.36 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
</pre></div></div>
</div>
<p>Not bad, huh? Add one line of code, and this speeds up by 600x!</p>
<p>But as I said, it doesn’t work with everything. Here’s an <a class="reference external" href="http://numba.pydata.org/numba-doc/latest/user/5minguide.html">intro to numba</a>, and here’s a <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/reference/numpysupported.html">full list of things it can handle in nopython mode, and things it can’t.</a>.</p>
<p>Also, as with Cython, note that <strong>in nopython Numba functions, loops are just as fast as vectorized code!</strong></p>
</div>
<div class="section" id="Use-Julia">
<h2>Use Julia<a class="headerlink" href="#Use-Julia" title="Permalink to this headline">¶</a></h2>
<p>I would be remiss at this point to not mention one other option for getting more speed: use the programming language <a class="reference external" href="https://julialang.org/">Julia</a>. Julia is a very new language that has syntax that is <em>very</em> similar to Python, but which <a class="reference external" href="https://julialang.org/benchmarks/">runs tens or hundreds of times faster out of the box</a>. Basically, it’s kinda like an entire language built around the technology also used by <code class="docutils literal notranslate"><span class="pre">numba</span></code>, but where <code class="docutils literal notranslate"><span class="pre">numba</span></code> is kind of finiky because it’s been tacked on
to a language that was never built for speed, Julia was designed from the ground up for speed.</p>
<p>If you want to know why I love Julia, <a class="reference external" href="https://www.youtube.com/watch?v=C4dMYHzW-SY">you can find a talk I gave on it here</a>. It’s a little old (I refer to Julia 1.0 not being out yet, but Julia’s up to 1.2 now), but the core arguments all still apply.</p>
<p>To be clear, I wouldn’t recommend jumping languages if you just have one function you need to speed up, but if you’re doing work that causes you to have performance issues regularly, consider Julia.</p>
</div>
<div class="section" id="Parallelization">
<h2>Parallelization<a class="headerlink" href="#Parallelization" title="Permalink to this headline">¶</a></h2>
<p>If you’ve done all this and your code is <em>still</em> too slow, it’s time to look into <a class="reference internal" href="parallelism.html"><span class="doc">parallelization, which we’re doing next!</span></a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Practical DS</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="not_a_mids_student.html">Not a MIDS Student?</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_part1.html">Command Line, Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_part2.html">Command Line, Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_environment.html">Setting Up Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="managing_python_packages.html">Managing Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_v_r.html">Python / R Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="vars_v_objects.html">Python: Vars v Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="ints_and_floats.html">Numbers in Computers</a></li>
<li class="toctree-l1"><a class="reference internal" href="pandas_series.html">Pandas 1: Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="pandas_dataframes.html">Pandas 2: DataFrames</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting_part1.html">Plotting, Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting_part2.html">Plotting, Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="views_and_copies_in_pandas.html">Pandas 3: Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_help.html">Getting Help Online</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_is_big_data.html">What is Big Data?</a></li>
<li class="toctree-l1"><a class="reference internal" href="big_data_strategies.html">Working with Big Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_understanding.html">Understanding Performance</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Solving Performance Probs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Profiling-Code">Profiling Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Speeding-Code-with-Cython">Speeding Code with Cython</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Speeding-Code-with-Numba">Speeding Code with Numba</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Use-Julia">Use Julia</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Parallelization">Parallelization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parallelism.html">Parallel Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_and_github.html">Git and Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="defensive_programming.html">Defensive Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise_list.html">All Exercises</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="performance_understanding.html" title="previous chapter">Speed in Python</a></li>
      <li>Next: <a href="parallelism.html" title="next chapter">Parallel Computing</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Nick Eubank.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/performance_solutions.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-133829453-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>